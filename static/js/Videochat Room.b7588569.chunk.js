(self.webpackChunkap_education=self.webpackChunkap_education||[]).push([[6225],{53164:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>G});var r=t(72791),i=t(57689),a=t(1672),c=t.n(a);const o=e=>{const[n,t]=(0,r.useState)(e),i=(0,r.useRef)(null),a=(0,r.useCallback)(((e,n)=>{i.current=n,t((n=>"function"===typeof e?e(n):e))}),[]);return(0,r.useEffect)((()=>{i.current&&(i.current(n),i.current=null)}),[n]),[n,a]};var s=t(6205),l=t(17922);const d="LOCAL_VIDEO";var u,p,f,E,b,g,m,x,h,Z,v,C,I=t(30168),D=t(76487);const k=D.ZP.div(u||(u=(0,I.Z)(["\n  display: flex;\n  height: 100vh;\n"]))),O=D.ZP.div(p||(p=(0,I.Z)(["\n  background-color: darkslateblue;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-basis: 80%;\n  padding: 36px;\n  gap: 16px;\n  max-width: 80%;\n"]))),j=D.ZP.div(f||(f=(0,I.Z)(["\n  position: relative;\n  background-color: black;\n  width: 100%;\n  height: 100%;\n  flex-basis: 70%;\n  max-height: 70%;\n"]))),R=D.ZP.div(E||(E=(0,I.Z)(["\n  display: flex;\n  gap: 8px;\n  overflow-x: auto;\n  flex-basis: 30%;\n  max-width: 100%;\n"]))),S=D.ZP.div(b||(b=(0,I.Z)(["\n  width: 250px;\n  height: 100%;\n  display: flex;\n  flex-shrink: 0;\n  background-color: black;\n  position: relative;\n"]))),A=D.ZP.div(g||(g=(0,I.Z)(["\n  background-color: beige;\n  display: flex;\n  flex-basis: 20%;\n  flex-shrink: 0;\n"]))),_=D.ZP.div(m||(m=(0,I.Z)(["\n  background-color: transparent;\n  display: flex;\n  gap: 8px;\n  position: absolute;\n  bottom: 16px;\n  right: 16px;\n  padding: 8px;\n"]))),w=D.ZP.div(x||(x=(0,I.Z)(["\n  display: flex;\n  border-radius: 16px;\n  padding: 8px;\n  background-color: rgba(0, 0, 0, 0.6);\n  border: 1px solid gray;\n"]))),M=D.ZP.button(h||(h=(0,I.Z)(["\n  background-color: transparent;\n  color: white;\n  border: none;\n  cursor: pointer;\n"]))),P=D.ZP.select(Z||(Z=(0,I.Z)(["\n  background-color: transparent;\n  color: white;\n  cursor: pointer;\n  padding: 8px;\n  max-width: 20px;\n  border: none;\n  outline: none;\n  border-left: 1px solid gray;\n"]))),y=D.ZP.option(v||(v=(0,I.Z)(["\n  background-color: rgba(0, 0, 0, 0.7);\n"]))),L=D.ZP.div(C||(C=(0,I.Z)(["\n  color: red;\n  position: absolute;\n  bottom: 8px;\n  left: 8px;\n"])));var T=t(80184);const G=function(){const{id:e}=(0,i.UO)(),{clients:n,provideMediaRef:t,toggleCamera:a,toggleMicrophone:u,isLocalCameraEnabled:p,isLocalMicrophoneEnabled:f}=function(e){const[n,t]=o([]),[i,a]=(0,r.useState)(!0),[u,p]=(0,r.useState)(!0),f=(0,r.useCallback)((e=>e===d?"admin":"user"),[]),E=(0,r.useCallback)(((e,n)=>{t((n=>{if(!n.some((n=>n.clientId===e))){const t=f(e);return[...n,{clientId:e,role:t,isMicroEnabled:!0,isCameraEnabled:!0}]}return n}),n)}),[t,f]),b=(0,r.useRef)({}),g=(0,r.useRef)(null),m=(0,r.useRef)({[d]:null});return(0,r.useEffect)((()=>{async function e(e){let{peerID:n,createOffer:t}=e;if(b.current[n])return console.warn("Already connected to peer ".concat(n));const r=new RTCPeerConnection({iceServers:c()()});b.current[n]=r,r.onicecandidate=e=>{e.candidate&&s.Z.emit(l.Z.RELAY_ICE,{peerID:n,iceCandidate:e.candidate})};let i=0;if(r.ontrack=e=>{let{streams:[t]}=e;i++,2===i&&E(n,(()=>{m.current[n]&&(m.current[n].srcObject=t)}))},g.current&&g.current.getTracks().forEach((e=>{r.addTrack(e,g.current)})),t){const e=await r.createOffer();await r.setLocalDescription(e),s.Z.emit(l.Z.RELAY_SDP,{peerID:n,sessionDescription:e})}}return s.Z.on(l.Z.ADD_PEER,e),()=>{s.Z.off(l.Z.ADD_PEER,e)}}),[E]),(0,r.useEffect)((()=>{async function e(e){let{peerID:n,sessionDescription:t}=e;const r=b.current[n];if(r&&(await r.setRemoteDescription(new RTCSessionDescription(t)),"offer"===t.type)){const e=await r.createAnswer();await r.setLocalDescription(e),s.Z.emit(l.Z.RELAY_SDP,{peerID:n,sessionDescription:e})}}return s.Z.on(l.Z.SESSION_DESCRIPTION,e),()=>{s.Z.off(l.Z.SESSION_DESCRIPTION,e)}}),[]),(0,r.useEffect)((()=>{const e=e=>{let{peerID:n,iceCandidate:t}=e;const r=b.current[n];r&&r.addIceCandidate(new RTCIceCandidate(t))};return s.Z.on(l.Z.ICE_CANDIDATE,e),()=>{s.Z.off(l.Z.ICE_CANDIDATE,e)}}),[]),(0,r.useEffect)((()=>{const e=e=>{let{peerID:n}=e;const r=b.current[n];r&&r.close(),delete b.current[n],delete m.current[n],t((e=>e.filter((e=>e!==n))))};return s.Z.on(l.Z.REMOVE_PEER,e),()=>{s.Z.off(l.Z.REMOVE_PEER,e)}}),[t]),(0,r.useEffect)((()=>(async function(){try{g.current=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:1280,height:720}}),E(d,(()=>{const e=m.current.LOCAL_VIDEO;e&&(e.volume=0,e.srcObject=g.current)})),s.Z.emit(l.Z.JOIN,{room:e})}catch(n){console.error("Error getting userMedia:",n)}}(),()=>{g.current&&g.current.getTracks().forEach((e=>e.stop())),s.Z.emit(l.Z.LEAVE)})),[E,e]),(0,r.useEffect)((()=>{s.Z.on(l.Z.TOGGLE_MICRO,(e=>{t((n=>n.map((n=>n.clientId===e.peerID?{...n,isMicroEnabled:e.isMicroEnabled}:{...n}))))})),s.Z.on(l.Z.TOGGLE_CAMERA,(e=>{t((n=>n.map((n=>n.clientId===e.peerID?{...n,isCameraEnabled:e.isCameraEnabled}:{...n}))))}))}),[t]),{clients:n,provideMediaRef:(0,r.useCallback)(((e,n)=>{m.current[e]=n}),[]),toggleCamera:()=>{if(g.current){const e=g.current.getTracks().find((e=>"video"===e.kind));if(e){e.enabled=!e.enabled,Object.entries(b.current).forEach((n=>{let[t,r]=n;r.getSenders().find((e=>"video"===e.track.kind)).track.enabled=e.enabled})),a(e.enabled);const n=m.current.LOCAL_VIDEO;e.enabled?n.srcObject=g.current:n.srcObject=null,s.Z.emit(l.Z.TOGGLE_CAMERA,{isCameraEnabled:e.enabled})}}},toggleMicrophone:()=>{if(g.current){const e=g.current.getTracks().find((e=>"audio"===e.kind));e&&(e.enabled=!e.enabled,Object.entries(b.current).forEach((n=>{let[t,r]=n;r.getSenders().find((e=>"audio"===e.track.kind)).track.enabled=e.enabled})),p(e.enabled),s.Z.emit(l.Z.TOGGLE_MICRO,{isMicroEnabled:e.enabled}))}},isLocalCameraEnabled:i,isLocalMicrophoneEnabled:u}}(e),[E,b]=(0,r.useState)([]),[g,m]=(0,r.useState)([]),[x,h]=(0,r.useState)([]);(0,r.useEffect)((()=>{Z()}),[]),(0,r.useEffect)((()=>{const e=E.filter((e=>"videoinput"===e.kind)),n=E.filter((e=>"audioinput"===e.kind));m(e),h(n)}),[E]);const Z=async()=>{const e=await navigator.mediaDevices.enumerateDevices();b(e)};return(0,T.jsxs)(k,{children:[(0,T.jsxs)(O,{children:[(0,T.jsxs)(R,{children:[n.filter((e=>{let{role:n}=e;return"admin"!==n})).map((e=>{let{clientId:n,isMicroEnabled:r,isCameraEnabled:i}=e;return(0,T.jsxs)(S,{id:n,children:[(0,T.jsx)("video",{width:"100%",height:"100%",ref:e=>{t(n,e)},autoPlay:!0,playsInline:!0,muted:n===d}),!i&&(0,T.jsx)(L,{children:"Camera Disabled"}),!r&&(0,T.jsx)(L,{children:"Micro Disabled"})]},n)})),(0,T.jsx)(S,{}),(0,T.jsx)(S,{}),(0,T.jsx)(S,{}),(0,T.jsx)(S,{}),(0,T.jsx)(S,{}),(0,T.jsx)(S,{}),(0,T.jsx)(S,{})]}),n.filter((e=>{let{role:n}=e;return"admin"===n})).map((e=>{let{clientId:n}=e;return(0,T.jsxs)(j,{id:n,children:[(0,T.jsx)("video",{width:"100%",height:"100%",ref:e=>{t(n,e)},autoPlay:!0,playsInline:!0,muted:n===d}),!p&&(0,T.jsx)(L,{children:"Camera Disabled"}),!f&&(0,T.jsx)(L,{children:"Micro Disabled"})]},n)})),(0,T.jsxs)(_,{children:[(0,T.jsxs)(w,{children:[(0,T.jsx)(M,{onClick:u,children:"Micro"}),(0,T.jsx)(P,{name:"micro",id:"micro",children:x.map((e=>(0,T.jsx)(y,{value:e.deviceId,children:e.label},e.deviceId)))})]}),(0,T.jsxs)(w,{children:[(0,T.jsx)(M,{onClick:a,children:"Camera"}),(0,T.jsx)(P,{name:"camera",id:"camera",children:g.map((e=>(0,T.jsx)(y,{value:e.deviceId,children:e.label},e.deviceId)))})]})]})]}),(0,T.jsx)(A,{children:"TODO: text chat"})]})}},17922:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});const r={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description",TOGGLE_MICRO:"toggle-micro",TOGGLE_CAMERA:"toggle-camera"}},6205:(e,n,t)=>{"use strict";t.d(n,{Z:()=>r});const r=(0,t(91608).io)("wss://ap-server-8qi1.onrender.com",{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]})},1672:(e,n,t)=>{"use strict";var r=t(94696);e.exports=function(e){var n,i={stun:(e||{}).stun||t(78808),turn:(e||{}).turn||t(44576)},a=(e||{}).stunCount||2,c=(e||{}).turnCount||0;function o(e,n){for(var t,a=[],c=[].concat(i[e]);c.length&&a.length<n;)t=Math.random()*c.length|0,a=a.concat(c.splice(t,1));return a.map((function(n){return"string"===typeof n||n instanceof String?r(e+":"+n):n}))}return n=[].concat(o("stun",a)),c&&(n=n.concat(o("turn",c))),n}},94696:e=>{var n=["stun:","turn:"];e.exports=function(e){var t,r,i=(e||{}).url||e,a={};return"string"==typeof i||i instanceof String?(i=i.trim(),(t=n[n.indexOf(i.slice(0,5))])?(r=(i=i.slice(5)).split("@"),a.username=e.username,a.credential=e.credential,r.length>1&&(i=r[1],r=r[0].split(":"),a.username=r[0],a.credential=(e||{}).credential||r[1]||""),a.url=t+i,a.urls=[a.url],a):e):e}},78808:e=>{"use strict";e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},44576:e=>{"use strict";e.exports=[]}}]);
//# sourceMappingURL=Videochat Room.b7588569.chunk.js.map