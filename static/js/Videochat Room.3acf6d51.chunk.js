(self.webpackChunkap_education=self.webpackChunkap_education||[]).push([[6225],{27210:(e,n,r)=>{"use strict";r.d(n,{Cf:()=>Y,DK:()=>J,Dx:()=>G,FX:()=>T,II:()=>z,JP:()=>y,Pf:()=>X,W2:()=>N,XI:()=>R,YD:()=>S,ZQ:()=>O,_L:()=>L,__:()=>V,_z:()=>Z,d2:()=>j,fm:()=>A,gS:()=>_,gs:()=>q,qt:()=>M,uU:()=>w,zx:()=>U});var t,o,i,a,c,s,d,l,u,p,f,g,x,b,m,h,E,v,k,I,C,D=r(30168),P=r(76487);const Z=P.ZP.div(t||(t=(0,D.Z)(["\n  display: flex;\n  height: 100vh;\n"]))),O=P.ZP.div(o||(o=(0,D.Z)(["\n  background-color: darkslateblue;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex-basis: 80%;\n  padding: 36px;\n  gap: 16px;\n  max-width: 80%;\n"]))),R=P.ZP.div(i||(i=(0,D.Z)(["\n  position: relative;\n  background-color: black;\n  width: 100%;\n  height: 100%;\n  flex-basis: 70%;\n  max-height: 70%;\n"]))),j=P.ZP.div(a||(a=(0,D.Z)(["\n  display: flex;\n  gap: 8px;\n  overflow-x: auto;\n  flex-basis: 30%;\n  max-width: 100%;\n"]))),y=P.ZP.div(c||(c=(0,D.Z)(["\n  width: 250px;\n  height: 100%;\n  display: flex;\n  flex-shrink: 0;\n  background-color: black;\n  position: relative;\n"]))),w=P.ZP.div(s||(s=(0,D.Z)(["\n  background-color: beige;\n  display: flex;\n  flex-basis: 20%;\n  flex-shrink: 0;\n"]))),S=P.ZP.div(d||(d=(0,D.Z)(["\n  background-color: transparent;\n  display: flex;\n  gap: 8px;\n  position: absolute;\n  bottom: 16px;\n  right: 16px;\n  padding: 8px;\n"]))),_=P.ZP.div(l||(l=(0,D.Z)(["\n  display: flex;\n  border-radius: 16px;\n  padding: 8px;\n  background-color: rgba(0, 0, 0, 0.6);\n  border: 1px solid gray;\n"]))),L=P.ZP.button(u||(u=(0,D.Z)(["\n  background-color: transparent;\n  color: white;\n  border: none;\n  cursor: pointer;\n"]))),A=P.ZP.select(p||(p=(0,D.Z)(["\n  background-color: transparent;\n  color: white;\n  cursor: pointer;\n  padding: 8px;\n  max-width: 20px;\n  border: none;\n  outline: none;\n  border-left: 1px solid gray;\n"]))),M=P.ZP.option(f||(f=(0,D.Z)(["\n  background-color: rgba(0, 0, 0, 0.7);\n"]))),T=P.ZP.div(g||(g=(0,D.Z)(["\n  color: red;\n  position: absolute;\n  bottom: 8px;\n  left: 8px;\n"]))),N=P.ZP.div(x||(x=(0,D.Z)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 20px;\n  padding: 20px;\n  background-color: #f9f9f9;\n  border-radius: 8px;\n  max-width: 600px;\n  margin: 0 auto;\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n"]))),G=P.ZP.h1(b||(b=(0,D.Z)(["\n  font-size: 24px;\n  color: #333;\n"]))),J=P.ZP.h3(m||(m=(0,D.Z)(["\n  font-size: 20px;\n  color: #555;\n  margin-bottom: 10px;\n"]))),V=P.ZP.label(h||(h=(0,D.Z)(["\n  font-size: 16px;\n  color: #444;\n"]))),z=P.ZP.input(E||(E=(0,D.Z)(["\n  padding: 10px;\n  font-size: 16px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  width: 100%;\n"]))),U=P.ZP.button(v||(v=(0,D.Z)(["\n  padding: 10px 20px;\n  font-size: 16px;\n  background-color: #007bff;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: background-color 0.3s;\n\n  &:hover {\n    background-color: #0056b3;\n  }\n"]))),X=P.ZP.ul(k||(k=(0,D.Z)(["\n  list-style: none;\n  padding: 0;\n  width: 100%;\n"]))),Y=P.ZP.li(I||(I=(0,D.Z)(["\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 4px;\n  margin-bottom: 10px;\n"]))),q=(0,P.ZP)(U)(C||(C=(0,D.Z)(["\n  background-color: #28a745;\n\n  &:hover {\n    background-color: #218838;\n  }\n"])))},98430:(e,n,r)=>{"use strict";r.r(n),r.d(n,{default:()=>b});var t=r(72791),o=r(57689),i=r(1672),a=r.n(i);const c=e=>{const[n,r]=(0,t.useState)(e),o=(0,t.useRef)(null),i=(0,t.useCallback)(((e,n)=>{o.current=n,r((n=>"function"===typeof e?e(n):e))}),[]);return(0,t.useEffect)((()=>{o.current&&(o.current(n),o.current=null)}),[n]),[n,i]};const s=(0,r(91608).io)("wss://ap-server-8qi1.onrender.com",{"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]}),d={JOIN:"join",LEAVE:"leave",SHARE_ROOMS:"share-rooms",ADD_PEER:"add-peer",REMOVE_PEER:"remove-peer",RELAY_SDP:"relay-sdp",RELAY_ICE:"relay-ice",ICE_CANDIDATE:"ice-candidate",SESSION_DESCRIPTION:"session-description",TOGGLE_MICRO:"toggle-micro",TOGGLE_CAMERA:"toggle-camera",RECEIVE_ROLE:"receive-role",SEND_ROLE:"send-role"};var l=r(88158),u=r(55294);u.Z.defaults.baseURL="https://ap-server-8qi1.onrender.com";const p="LOCAL_VIDEO";function f(e){const[n,r]=c([]),[o,i]=(0,t.useState)(!0),[f,g]=(0,t.useState)(!0),[x,b]=(0,t.useState)([]),[m,h]=(0,t.useState)(null),E=async()=>{if(!(0,l.L)())return void h("user");const n=await(async e=>{try{return(await u.Z.get("/rooms/isRoomAdmin?id=".concat(e),{headers:{Authorization:"Bearer ".concat((0,l.L)())}})).data.isRoomAdmin}catch(n){console.error("Error determining user role:",n)}})(e)?"admin":"user";h(n)},v=(0,t.useCallback)((async(e,n,t)=>{r((r=>r.some((n=>n.clientId===e))?r:[...r,{clientId:e,role:n,isMicroEnabled:!0,isCameraEnabled:!0}]),t)}),[r]),k=(0,t.useRef)({}),I=(0,t.useRef)(null),C=(0,t.useRef)({[p]:null});async function D(e){let{peerID:n,roles:r,createOffer:t}=e;if(k.current[n])return console.warn("Already connected to peer ".concat(n));const o=new RTCPeerConnection({iceServers:a()()});k.current[n]=o,o.onicecandidate=e=>{e.candidate&&s.emit(d.RELAY_ICE,{peerID:n,iceCandidate:e.candidate})};let i=0;if(o.ontrack=e=>{let{streams:[t]}=e;i++,2===i&&v(n,r[n],(()=>{C.current[n]&&(C.current[n].srcObject=t)}))},I.current&&I.current.getTracks().forEach((e=>{o.addTrack(e,I.current)})),t){const e=await o.createOffer();await o.setLocalDescription(e),s.emit(d.RELAY_SDP,{peerID:n,sessionDescription:e})}}async function P(e){let{peerID:n,sessionDescription:r}=e;const t=k.current[n];if(t&&(await t.setRemoteDescription(new RTCSessionDescription(r)),"offer"===r.type)){const e=await t.createAnswer();await t.setLocalDescription(e),s.emit(d.RELAY_SDP,{peerID:n,sessionDescription:e})}}const Z=e=>{let{peerID:n,iceCandidate:r}=e;const t=k.current[n];t&&t.addIceCandidate(new RTCIceCandidate(r))},O=e=>{let{peerID:n}=e;const t=k.current[n];t&&t.close(),delete k.current[n],delete C.current[n],r((e=>e.filter((e=>e.clientId!==n))))};(0,t.useEffect)((()=>{E()}),[]),(0,t.useEffect)((()=>(s.on(d.ADD_PEER,D),()=>{s.off(d.ADD_PEER,D)})),[v]),(0,t.useEffect)((()=>(s.on(d.SESSION_DESCRIPTION,P),()=>{s.off(d.SESSION_DESCRIPTION,P)})),[]),(0,t.useEffect)((()=>(s.on(d.ICE_CANDIDATE,Z),()=>{s.off(d.ICE_CANDIDATE,Z)})),[]),(0,t.useEffect)((()=>(s.on(d.REMOVE_PEER,O),()=>{s.off(d.REMOVE_PEER,O)})),[r]),(0,t.useEffect)((()=>(async function(){try{I.current=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:1280,height:720}});const n=await navigator.mediaDevices.enumerateDevices();b(n),m&&(v(p,m,(()=>{const e=C.current.LOCAL_VIDEO;e&&(e.volume=0,e.srcObject=I.current)})),s.emit(d.JOIN,{room:e,role:m}))}catch(n){console.error("Error getting userMedia:",n)}}(),()=>{I.current&&I.current.getTracks().forEach((e=>e.stop())),s.emit(d.LEAVE)})),[v,e,m]),(0,t.useEffect)((()=>{s.on(d.TOGGLE_MICRO,(e=>{r((n=>n.map((n=>n.clientId===e.peerID?{...n,isMicroEnabled:e.isMicroEnabled}:{...n}))))})),s.on(d.TOGGLE_CAMERA,(e=>{r((n=>n.map((n=>n.clientId===e.peerID?{...n,isCameraEnabled:e.isCameraEnabled}:{...n}))))}))}),[r]);return{clients:n,provideMediaRef:(0,t.useCallback)(((e,n)=>{C.current[e]=n}),[]),localDevices:x,toggleCamera:()=>{if(I.current){const e=I.current.getTracks().find((e=>"video"===e.kind));if(e){e.enabled=!e.enabled,Object.entries(k.current).forEach((n=>{let[r,t]=n;t.getSenders().find((e=>"video"===e.track.kind)).track.enabled=e.enabled})),i(e.enabled);const n=C.current.LOCAL_VIDEO;e.enabled?n.srcObject=I.current:n.srcObject=null,s.emit(d.TOGGLE_CAMERA,{isCameraEnabled:e.enabled})}}},toggleMicrophone:()=>{if(I.current){const e=I.current.getTracks().find((e=>"audio"===e.kind));e&&(e.enabled=!e.enabled,Object.entries(k.current).forEach((n=>{let[r,t]=n;t.getSenders().find((e=>"audio"===e.track.kind)).track.enabled=e.enabled})),g(e.enabled),s.emit(d.TOGGLE_MICRO,{isMicroEnabled:e.enabled}))}},changeCamera:async e=>{try{const n=(await navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{exact:e}}})).getVideoTracks()[0];k.current&&Object.keys(k.current).forEach((e=>{const r=k.current[e].getSenders().find((e=>e.track&&"video"===e.track.kind));r&&r.replaceTrack(n)}))}catch(n){console.error("error change camera: "+n)}},changeMicrophone:async e=>{try{const n=(await navigator.mediaDevices.getUserMedia({audio:{deviceId:{exact:e}},video:!1})).getAudioTracks()[0];k.current&&Object.keys(k.current).forEach((e=>{const r=k.current[e].getSenders().find((e=>e.track&&"audio"===e.track.kind));r&&r.replaceTrack(n)}))}catch(n){console.error("error change micro: "+n)}},isLocalCameraEnabled:o,isLocalMicrophoneEnabled:f}}var g=r(27210),x=r(80184);const b=function(){const{id:e}=(0,o.UO)(),{clients:n,provideMediaRef:r,localDevices:i,toggleCamera:a,toggleMicrophone:c,changeCamera:s,changeMicrophone:d,isLocalCameraEnabled:l,isLocalMicrophoneEnabled:u}=f(e),[b,m]=(0,t.useState)([]),[h,E]=(0,t.useState)([]);return(0,t.useEffect)((()=>{const e=i.filter((e=>"videoinput"===e.kind)),n=i.filter((e=>"audioinput"===e.kind));E(n),m(e)}),[i]),(0,x.jsxs)(g._z,{children:[(0,x.jsx)("button",{onClick:()=>{console.log(n)},children:"get clients"}),(0,x.jsxs)(g.ZQ,{children:[(0,x.jsxs)(g.d2,{children:[n.filter((e=>{let{role:n}=e;return"admin"!==n})).map((e=>{let{clientId:n,isMicroEnabled:t,isCameraEnabled:o}=e;return(0,x.jsxs)(g.JP,{id:n,children:[(0,x.jsx)("video",{width:"100%",height:"100%",ref:e=>{r(n,e)},autoPlay:!0,playsInline:!0,muted:n===p}),!o&&(0,x.jsx)(g.FX,{children:"Camera Disabled"}),!t&&(0,x.jsx)(g.FX,{children:"Micro Disabled"})]},n)})),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{}),(0,x.jsx)(g.JP,{})]}),n.filter((e=>{let{role:n}=e;return"admin"===n})).map((e=>{let{clientId:n}=e;return(0,x.jsxs)(g.XI,{id:n,children:[(0,x.jsx)("video",{width:"100%",height:"100%",ref:e=>{r(n,e)},autoPlay:!0,playsInline:!0,muted:n===p}),!l&&(0,x.jsx)(g.FX,{children:"Camera Disabled"}),!u&&(0,x.jsx)(g.FX,{children:"Micro Disabled"})]},n)})),(0,x.jsxs)(g.YD,{children:[(0,x.jsxs)(g.gS,{children:[(0,x.jsx)(g._L,{onClick:c,children:"Micro"}),(0,x.jsx)(g.fm,{name:"micro",id:"micro",onChange:e=>d(e.target.value),children:h.map((e=>(0,x.jsx)(g.qt,{value:e.deviceId,children:e.label},e.deviceId)))})]}),(0,x.jsxs)(g.gS,{children:[(0,x.jsx)(g._L,{onClick:a,children:"Camera"}),(0,x.jsx)(g.fm,{name:"camera",id:"camera",onChange:e=>s(e.target.value),children:b.map((e=>(0,x.jsx)(g.qt,{value:e.deviceId,children:e.label},e.deviceId)))})]})]})]}),(0,x.jsx)(g.uU,{children:"TODO: text chat"})]})}},88158:(e,n,r)=>{"use strict";r.d(n,{L:()=>t});const t=()=>localStorage.getItem("token")},1672:(e,n,r)=>{"use strict";var t=r(94696);e.exports=function(e){var n,o={stun:(e||{}).stun||r(78808),turn:(e||{}).turn||r(44576)},i=(e||{}).stunCount||2,a=(e||{}).turnCount||0;function c(e,n){for(var r,i=[],a=[].concat(o[e]);a.length&&i.length<n;)r=Math.random()*a.length|0,i=i.concat(a.splice(r,1));return i.map((function(n){return"string"===typeof n||n instanceof String?t(e+":"+n):n}))}return n=[].concat(c("stun",i)),a&&(n=n.concat(c("turn",a))),n}},94696:e=>{var n=["stun:","turn:"];e.exports=function(e){var r,t,o=(e||{}).url||e,i={};return"string"==typeof o||o instanceof String?(o=o.trim(),(r=n[n.indexOf(o.slice(0,5))])?(t=(o=o.slice(5)).split("@"),i.username=e.username,i.credential=e.credential,t.length>1&&(o=t[1],t=t[0].split(":"),i.username=t[0],i.credential=(e||{}).credential||t[1]||""),i.url=r+o,i.urls=[i.url],i):e):e}},78808:e=>{"use strict";e.exports=JSON.parse('["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org"]')},44576:e=>{"use strict";e.exports=[]}}]);
//# sourceMappingURL=Videochat Room.3acf6d51.chunk.js.map